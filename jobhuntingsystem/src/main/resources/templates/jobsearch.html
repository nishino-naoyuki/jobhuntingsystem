<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ヘッダー -->
  <div id="parent" th:replace="/common/headerlink"></div>  
</head>

<body>

  
  <!-- ヘッダー -->
  <div id="parent" th:replace="/common/header"></div>  
  
  <!-- サイドバー -->
  <div id="parent" th:replace="/common/sidebar"></div> 

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>求人検索</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
    	<div class="row">
    		<div class="col-lg-12">
    			<div class="card">
    				<div class="card-body">
    					<h5 class="card-title">検索条件</h5>
		                	<div class="row mb-3">
								<label for="inputText" class="col-sm-2 col-form-label">企業名</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" id="companyName">
								</div>
								<label for="inputText" class="col-sm-2 col-form-label">企業名（ヨミガナ）</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" id="companyNameKana">
								</div>
							</div>
		                	<div class="row mb-3">
								<label for="inputText" class="col-sm-2 col-form-label">対象年度</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" id="targetYear">
								</div>
							</div>
		                	<div class="row mb-3">
		                		<div class="col-sm-12">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" id="gridCheck1">
										<label class="form-check-label" for="gridCheck1">
											終了分も表示する
										</label>
									</div>
		                		</div>
							</div>
		                	<div class="row mb-3">
								<label for="inputText" class="col-sm-2 col-form-label">勤務地</label>
								<div class="col-sm-10"><div class="accordion" id="accordionExample">
										<div class="accordion-item">
											<h2 class="accordion-header" id="headingPlace">
												<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePlace" aria-expanded="false" aria-controls="collapseOne">
													勤務地
												</button>
											</h2>
											<div id="collapsePlace" class="accordion-collapse collapse" aria-labelledby="headingPlace" data-bs-parent="#accordionExample">
												<div class="accordion-body">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck1">
														<label class="form-check-label" for="gridCheck1">
															福岡
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															佐賀
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															熊本
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															長崎
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															大分
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															宮﨑
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															鹿児島
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															関東
														</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="gridCheck2" checked>
														<label class="form-check-label" for="gridCheck2">
															その他
														</label>
													</div>
												</div>
											</div>
										</div><!-- accordion-item -->
									</div><!-- accordion -->
								</div>
							</div>
		                	<div class="row mb-3">
								<label for="inputText" class="col-sm-2 col-form-label">募集職種</label>
								<div class="col-sm-10">
									<div class="accordion" id="accordionExample">
										<div class="accordion-item" th:each="industry,stat : ${industryList}">
											<h2 class="accordion-header" th:id="|heading${industry.id}|">
												<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" th:data-bs-target="|#collapse${industry.id}|" aria-expanded="false" th:aria-controls="|collapse${industry.id}|" th:text="${industry.name}">
												</button>
											</h2>
											<div th:id="|collapse${industry.id}|" class="accordion-collapse collapse" th:aria-labelledby="|heading${industry.id}|" data-bs-parent="#accordionExample">
												<div class="accordion-body">
													<div th:each="kind : ${industry.kindList}" class="form-check">
														<input class="form-check-input" type="checkbox" th:value="${kind.id}" th:name="|industryKind${stat.count}|" >
														<label class="form-check-label" for="gridCheck1" th:text="${kind.name}">
															
														</label>
													</div>
												</div>
											</div>
										</div><!-- accordion-item -->
									</div><!-- accordion -->
								</div>
							</div>
							<div class="d-grid gap-2 col-6 mx-auto">
								<button class="btn btn-outline-primary" id="searchButton">検索</button>
							</div>
    				</div>
    			</div><!-- card -->
    		</div><!-- col-lg-12 -->
    	</div><!--row-->
    	<div class="row">
    		 <div class="col-lg-12">
    		 	<div class="card">
    		 		<div class="card-body">
              			<h5 class="card-title">検索結果</h5>
              			<button class="btn btn-outline-primary">CSV出力</button>
              			<table class="table table-bordered table-striped" id="jobList">
	              			<thead>
			                  <tr>			                    
			                    <th>企業名</th>
			                    <th>種類</th>
			                    <th>契約</th>
			                    <th>対象</th>
			                    <th>募集中</th>
			                    <th>募集職種</th>
			                    <th>参加者一覧（先生権限）</th>
			                  </tr>
			                </thead>
			                <tbody>
			                </tbody>
              			</table><!-- table -->
              		</div><!-- card-body -->
    		 	</div><!-- card -->
    		 </div><!-- col-lg-12 -->
    	</div><!--row-->
    </section>

  </main><!-- End #main -->

  <!-- フッター -->
  <div id="parent" th:replace="/common/footer"></div>  
  <!-- フッターリンク -->
  <div id="parent" th:replace="/common/footerlink"></div>  
<link href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.0/datatables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.0/datatables.min.js"></script>

</body>

<script th:inline="javascript">
	const searchButton = document.getElementById("searchButton");
	let  dataTable = $('#jobList').DataTable({
	   	      "paging": true,
      			"destroy":true,
	   	      "lengthChange": false,
	   	      "searching": true,
	   	      "ordering": true,
	   	      "info": true,
	   	      "autoWidth": false,
	   	      "responsive": true,
    });

	const clickFavorit =(companyId) =>{
		alert(companyId);
	};
	
	searchButton.addEventListener('click',()=>{
		const companyName = document.getElementById("companyName");
		const companyNameKana = document.getElementById("companyNameKana");
		const targetYear = document.getElementById("targetYear");		
 		let industryArry = [];
 		let index = 0;
 		for(let id=1; id <= /*[[${industryList.size()}]]*/0; id++){
 			const industryKind = document.getElementsByName("industryKind"+id);
 			for( let i=0; i<industryKind.length; i++){
 				if( industryKind[i].checked ){
 					industryArry[index] = industryKind[i].value
 					index++;
 				}
 			}
 		} 		
 		
 		const formData = new FormData();
 		formData.append('companyName',companyName.value );
 		formData.append('companyNameKana',companyNameKana.value );
 		formData.append('targetYear',targetYear.value );
 		formData.append('industryArry',industryArry );
 		 		
        const url = /*[[@{/job/search}]]*/ "/job/search";
        fetch(url,{method:"post",body: formData})
        //レスポンスの受け取り
        .then( response => response.json()).then(resultList => {
 			//alert( resultList.length );
 			dataTable.clear();
 			dataTable.destroy();
 			
   		  dataTable = $('#jobList').DataTable({
	   	      "paging": true,
      			"destroy":true,
	   	      "lengthChange": false,
	   	      "searching": true,
	   	      "ordering": true,
	   	      "info": true,
	   	      "autoWidth": false,
	   	      "responsive": true,
				"data":resultList,
	            "columns": [
	            	{
	            		data:"companyName" ,
	            		type:"recruitmentId",
	                	render: function ( data, type, row ) {
	                		const url = /*[[@{/job/detail}]]*/ "/job/detail";

	                		return '<a href="'+url+'?recruitmentId='+row.recruitmentId+'" target="jobofferdetail">'+data+'</a>';
	                	}
	            	},
	            	{ data:"recruitmentType"},
	            	{ data:"type"},
	            	{
	            		data:"target" ,
	            		type:"type",
	                	render: function ( data, type, row ) {
	                		return data+'年卒';
	                	}
	            	},
	            	{
	            		data:"inOffer" ,
	            		type:"recruitmentId",
	                	render: function ( data, type, row ) {
	                		if( data ){
	                			return "募集中";
	                		}else{
	                			return "募集終了";
	                		}
	                	}
	            	},
	            	{
	            		data:"industryList" ,
	            		type:"recruitmentId",
	                	render: function ( data, type, row ) {
	                		let tagStr = "";
	                		for(let element of data){
	                			tagStr += '<span class="badge bg-primary companydetailicon">'+ element.name +'</span>'
	                		}
	                		return tagStr;
	                	}
	            	},
	            	{
	            		data:"industryList" ,
	            		type:"recruitmentId",
	                	render: function ( data, type, row ) {
	                		let tagStr = '<button class="btn btn-outline-primary">参加者一覧</button>';
	                		return tagStr;
	                	}
	            	}
	            ]
	   	    });
	   	    dataTable.draw();
 			//resultList.forEach(
 			//	element =>{
 			//		alert( element.name );
 			//	}
 			//);
 		});
	});
</script>
</html>